(function(){"use strict";var config={animationDuration:800};var viewport={},offset=0,curPane=false,pointerL=0,showContent=false;var Router=Backbone.Router.extend({routes:{"visit(/)":"visit","about(/)":"about","education(/)":"education","eco-centre(/)":"ecoCentre","environment(/)":"environment","news(/)":"news","news/:slug(/)":"singleArticle","events(/)":"events","events/:slug(/)":"singleEvent","*path":"home"},home:function(path){if(path)return router.navigate("/",{trigger:false,replace:true});switchHome()},visit:function(){switchView("visit-content","visit-pane")},about:function(){switchView("about-content","about-pane")},education:function(){switchView("education-content","education-pane")},ecoCentre:function(){switchView("eco-centre-content","eco-centre-pane")},environment:function(){switchView("environment-content","environment-pane")},news:function(){switchView("news-content","news-pane")},singleArticle:function(slug){$("body").addClass("item-loading");$("#single-item-placeholder").load("/news/"+slug+" article",function(){$("body").removeClass("item-loading");switchView("single-item-placeholder","news-pane")})},events:function(){switchView("events-content","events-pane")},singleEvent:function(slug){$("body").addClass("item-loading");$("#single-item-placeholder").load("/events/"+slug+" article",function(){switchView("single-item-placeholder","events-pane")})}});var router=new Router;$('a[href^="/"]').on("click",function(e){var href=$(this).attr("href");router.navigate(href,{trigger:true});e.preventDefault()});$('a[href="#"]').on("click",function(e){e.preventDefault()});$("#expand-menu-link").on("click",function(){$("body").toggleClass("expanded-menu")});$(".back-to-top").on("click",function(e){$("html,body").animate({scrollTop:0},800);e.preventDefault()});$(".pane").on("click",function(e){var $pane=$(this);$(".pane").removeClass("selected");$pane.addClass("selected")});$(".pane-content a").on("click",function(){$("body").addClass("collapsing-menu");setTimeout(function(){$("body").removeClass("expanded-menu collapsing-menu")},800)});$(".overflow-wrapper").find(".no-scroll").removeClass("no-scroll").addClass("horizontal-scroll-wrapper");$("window").on("resize",function(){fixPanesHeight();viewport=recalcViewport()});$(".next").on("click",function(){if(++curPane===5)curPane=0;rafCalc()});$(".prev").on("click",function(){if(--curPane===-1)curPane=4;rafCalc()});$(window).mousemove(function(e){pointerL=e.pageX;window.requestAnimationFrame(rafCalc)});fixPanesHeight();init();function init(){$(document).ready(function(){Backbone.history.start({pushState:true})});fixPanesHeight();viewport=recalcViewport();initialScrollTo();$.stellar({horizontalScrolling:false,hideDistantElements:false,verticalScrolling:true,verticalOffset:$(window).height()/2,responsive:true})}function switchHome(){$("body").removeClass("show-content expanded-menu");curPane=false;showContent=false}function loadArticle(slug){}function switchView(content_id,pane_id){var $targetContent=$("#"+content_id),$targetPane=$("#"+pane_id);$(".pane").removeClass("selected");$targetPane.addClass("selected");curPane=$targetPane.index();showContent=true;$(".content-wrapper").css({visibility:"hidden",height:"0"});$targetContent.css({visibility:"visible",height:""});setTimeout(function(){$.stellar("refresh")},100);$("body").addClass("show-content");if(!location.hash.length){$("html,body").animate({scrollTop:0},800)}rafCalc()}function initialScrollTo(){var hash=location.hash;if(!hash.length)return;setTimeout(function(){smoothScrollTo(hash)},500)}function smoothScrollTo(id){if(id[0]!=="#"){id="#"+id}var $target=$(id);if(!$target.length)return;$("html,body").animate({scrollTop:$target.offset().top-51},config.animationDuration)}function fixPanesHeight(){$("#scroll-wrapper").height($(window).height()-$("#main-navbar").outerHeight())}function recalcViewport(){return{height:$(window).height(),width:$(window).width()}}function rafCalc(){if(!showContent){offset=Math.min(.5*Math.max(pointerL-viewport.width/4,0),viewport.width/4)}else{if(curPane!==false)offset=curPane*viewport.width/4;else offset=0}offset=Math.round(offset);rafAnimation(offset)}function rafAnimation(offset){$("#scroll-wrapper").css("transform","translateX("+-offset+"px)")}})();$(function(){$('a[href*="#"]:not([href="#"])').click(function(e){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var target=$(this.hash);target=target.length?target:$("[name="+this.hash.slice(1)+"]");if(!target.length)return;$("html,body").animate({scrollTop:target.offset().top-51},800);$.stellar("_repositionElements");e.preventDefault()}})});
